<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ‰å®‡å¯§èª‡èª‡åœ˜æ–‡æ¡ˆç”¢ç”Ÿå™¨ ğŸŒ»</title>
    <!-- å¼•å…¥ Tailwind CSS CDN --><script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Lucide Icons for aesthetic icons --><script type="module" src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Base Styling & Font */
        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: #fcf8f0; /* Soft cream/yellow background */
        }
        
        /* Custom Scrollbar for Textareas */
        textarea::-webkit-scrollbar, .preview-box::-webkit-scrollbar {
            width: 6px;
        }
        textarea::-webkit-scrollbar-thumb, .preview-box::-webkit-scrollbar-thumb {
            background-color: #fcd34d; /* Yellow-400 */
            border-radius: 3px;
        }
        
        /* AI Button Primary Style (Now using flat, cleaner design) */
        .btn-primary {
            transition: all 0.15s ease;
            /* ç§»é™¤è‡ªå®šç¾©é™°å½±ï¼Œä½¿ç”¨æ›´ä¹¾æ·¨çš„é¢¨æ ¼ */
            background-color: #f97316; /* Orange-600 */
            @apply rounded-xl shadow-none; /* æ›´ç°¡æ½”çš„åœ“è§’å’Œç„¡é™°å½± */
        }
        .btn-primary:hover {
            transform: none; /* ç§»é™¤ hover æå‡æ•ˆæœ */
            box-shadow: none;
            background-color: #ea580c; /* Orange-700 */
        }
        .btn-primary:active {
            transform: translateY(1px);
            box-shadow: none;
        }

        /* Template Button Styling (Removed since we use select dropdown now) */
        .tab-btn {
            @apply p-2 sm:px-4 sm:py-2 border-2 border-yellow-500 rounded-lg cursor-pointer transition-all duration-200 text-sm font-semibold bg-white text-yellow-700 shadow-sm;
        }
        .tab-btn.active {
            @apply bg-yellow-500 text-white shadow-md;
        }
        .tab-btn:not(.active):hover {
            @apply bg-yellow-100;
        }


        /* Loading animation (Orange/Yellow Theme) */
        .loading-spinner {
            display: none;
            justify-content: center;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: bold;
            color: #f97316; /* Orange-600 for text */
            padding: 0; /* Adjusted padding */
        }
        .dot {
            width: 8px;
            height: 8px;
            background-color: #fcd34d; /* Yellow-400 dot */
            border-radius: 50%;
            animation: dot-bounce 1s infinite ease-in-out both;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes dot-bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        /* Copy Card Style (for batch results) */
        .copy-card {
            @apply p-4 border border-yellow-300 bg-white rounded-xl shadow-lg mb-4;
            transition: all 0.5s ease-out;
            opacity: 1;
        }
        .copy-card.fade-out {
            opacity: 0;
            height: 0;
            margin-top: 0;
            padding-top: 0;
            padding-bottom: 0;
            overflow: hidden;
        }

        /* Custom Toast Styles */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            display: none;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            color: white;
            font-weight: 600;
        }
        .toast.show { display: flex; }
        .toast-success { background-color: #10b981; } 
        .toast-warning { background-color: #f59e0b; } 
        .toast-error { background-color: #ef4444; } 
        .toast-info { background-color: #3b82f6; } 

        /* Ensure two columns on medium screens (md) for better preview visibility */
        @media (min-width: 768px) {
            .content-grid-wrapper {
                grid-template-columns: 1fr 1fr; 
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen flex items-center justify-center">

    <div class="container w-full max-w-4xl bg-white rounded-2xl shadow-xl border border-gray-100">
        <div class="header bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-8 rounded-t-2xl text-center">
            <h1 class="text-3xl sm:text-4xl font-extrabold tracking-wide mb-2 flex items-center justify-center">
                <i data-lucide="sun" class="w-7 h-7 mr-3"></i> åŠ‰å®‡å¯§èª‡èª‡åœ˜æ–‡æ¡ˆç”¢ç”Ÿå™¨ ğŸŒ»
            </h1>
            <p class="text-sm opacity-90">ä½œè€… by å°å…«å¯¶ç²¥ | åƒ…ä¾›æ‘©é£¯ä½¿ç”¨ï½œæœ‰å•é¡Œå¯è¯çµ¡ ig: md.8bao</p>
            <p class="text-xs opacity-70 mt-1">ç‰ˆæœ¬è™Ÿï¼šv2.5 (2025.11.24 æ›´æ–°)</p>
        </div>

        <div class="content p-6 sm:p-8">

            <!-- 1. é ‚éƒ¨ç¨ç«‹å€å¡Šï¼šè©•è«–æ–‡æ¡ˆï¼ˆå«å€‹äººIDï¼‰ - FULL WIDTH --><div class="section border-b pb-6 mb-6 border-orange-200">
                <div class="section-title text-orange-600 mb-4">
                    <i data-lucide="message-square" class="w-5 h-5 text-orange-400"></i>
                    è©•è«–æ–‡æ¡ˆï¼ˆå«å€‹äººIDï¼‰
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex-grow">
                        <label for="personalIdInput" class="block mb-2 text-gray-600 text-sm font-semibold">
                            è¼¸å…¥æ‚¨çš„å€‹äºº ID (å°‡è‡ªå‹•é™„åŠ åˆ°æ–‡æœ«ä¸¦è½‰ç‚ºç°¡é«”å­—)ï¼š
                        </label>
                        <input type="text" id="personalIdInput" value="å¯§çš„å‘æ—¥è‘µ" 
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors" 
                               placeholder="ä¾‹å¦‚ï¼šæ‘©é£¯ ID" oninput="saveSettings()">
                    </div>
                </div>
                
                <button class="btn w-full bg-orange-500 text-white hover:bg-orange-600 font-semibold mt-3 py-3 px-4 rounded-xl transition-colors" onclick="copyComment()">
                    <i data-lucide="copy" class="w-4 h-4 mr-2"></i>
                    è¤‡è£½å®Œæ•´è©•è«–æ–‡æ¡ˆ (ç°¡é«”)
                </button>
            </div>

            <!-- 2. å…©æ¬„ä½ˆå±€ï¼šå·¦å´æ§åˆ¶å° | å³å´çµæœ --><div class="grid grid-cols-1 md:grid-cols-2 gap-8 content-grid-wrapper">

                <!-- LEFT COLUMN: Settings & Generation Button (è²¼æ–‡æ§åˆ¶å°) --><div>
                    <!-- 2.1 è²¼æ–‡ç”Ÿæˆè¨­ç½®å€å¡Š (é¢¨æ ¼/æ¨¡æ¿/å½±ç‰‡/CR) --><div class="section mb-6">
                        <div class="section-title text-yellow-600 mb-4">
                            <i data-lucide="list-checks" class="w-5 h-5 text-yellow-400"></i>
                            è²¼æ–‡å…§å®¹è¨­ç½® (AI æ‰¹æ¬¡ç”Ÿæˆ)
                        </div>

                        <!-- NEW: æ–‡æ¡ˆé¢¨æ ¼é¸æ“‡ --><div class="mb-6">
                            <label for="styleSelect" class="block mb-2 text-gray-600 text-sm font-semibold">
                                ğŸ¨ æ–‡æ¡ˆç”Ÿæˆé¢¨æ ¼ï¼š
                            </label>
                            <select id="styleSelect" class="w-full p-3 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 appearance-none bg-white transition-colors">
                                <option value="å¤é¢¨å„ªé›…" selected>å¤é¢¨å„ªé›… (é è¨­)</option>
                                <option value="ç¾ä»£ç†±æƒ…">ç¾ä»£ç†±æƒ… (ç²‰çµ²å‘)</option>
                                <option value="é’æ˜¥æ´»åŠ›">é’æ˜¥æ´»åŠ› (æ¸…æ–°)</option>
                                <option value="è©©æ„æµªæ¼«">è©©æ„æµªæ¼« (æŠ’æƒ…)</option>
                            </select>
                        </div>
                        <!-- End NEW --><!-- æ¨¡æ¿é¸æ“‡ (Dropdown restored) --><div class="mb-3">
                            <label for="templateSelectDropdown" class="block mb-2 text-gray-600 text-sm font-semibold">
                                é¸æ“‡è²¼æ–‡æ¨¡æ¿ (Hashtag/æåŠ/é€£çµ)ï¼š
                            </label>
                            <!-- æ¢å¾©ä¸‹æ‹‰é¸å–® --><select id="templateSelectDropdown" onchange="selectTemplateDropdown(this.value)" 
                                    class="w-full p-3 border border-yellow-500 rounded-lg focus:ring-2 focus:ring-yellow-500 transition-colors bg-white shadow-sm font-semibold">
                                <!-- æ¨¡æ¿é¸é …ï¼Œdata-preview åŒ…å«æ‘˜è¦è³‡è¨Š --><option value="1" data-preview="OLAY ä»£è¨€, 2025å·¡æ¼”, æ‘©ç™»å…„å¼Ÿè¶…è©± (å«3é€£çµ)">æ¨¡æ¿ 1 (OLAY/å·¡æ¼”)</option>
                                <option value="2" data-preview="éŸ³æ¨‚ç·£è¨ˆåŠƒ, é–’é­šä»£è¨€, æ‘©ç™»å…„å¼Ÿè¶…è©± (å«3é€£çµ)">æ¨¡æ¿ 2 (éŸ³æ¨‚/é–’é­š)</option>
                                <option value="3" data-preview="æ–°æ­Œæ¦œå–®, é¨°è¨ŠéŸ³æ¨‚ç”±ä½ æ¦œ, æ‘©ç™»å…„å¼Ÿè¶…è©± (å«3é€£çµ)">æ¨¡æ¿ 3 (æ–°æ­Œ/æ¦œå–®)</option>
                            </select>
                            
                            <!-- æ¨¡æ¿å…§å®¹é è¦½å€å¡Š --><div id="templatePreviewSummary" class="text-sm mt-3 p-3 bg-yellow-100 text-yellow-800 rounded-lg border border-yellow-200 font-medium transition-opacity duration-300">
                                <!-- é è¨­é¡¯ç¤ºæ¨¡æ¿ 1 çš„å…§å®¹ --></div>
                        </div>

                        <!-- CR æµ®æ°´å°é¸é … --><div class="flex items-center mt-3 pt-2">
                            <input type="checkbox" id="crWatermarkCheckbox" 
                                   class="h-5 w-5 text-yellow-600 border-gray-300 rounded focus:ring-yellow-500" onchange="saveSettings()">
                            <label for="crWatermarkCheckbox" class="text-gray-700 select-none font-medium ml-2 text-sm">
                                è²¼æ–‡åº•éƒ¨æ·»åŠ ã€Œcr è¦‹æµ®æ°´å°ã€
                            </label>
                        </div>

                        <div class="grid grid-cols-1 gap-4 mt-6">
                            <!-- å½±ç‰‡é€£çµé¸æ“‡ (é¸å¡«) --><div class="col-span-1">
                                <label for="videoSelect" class="block mb-2 text-gray-600 text-sm font-semibold">
                                    ğŸ¬ é¸å¡«å½±ç‰‡é€£çµ
                                </label>
                                <select id="videoSelect" class="w-full p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-colors">
                                    <option value="" selected>âŒ ç„¡å½±ç‰‡ (åƒ…æ–‡æ¡ˆ)</option>
                                    <option value="RANDOM_ANY">ğŸ² éš¨æ©Ÿé¸æ“‡ä¸€æ¢å½±ç‰‡ (æ¯å¡ä¸åŒ)</option>
                                    <!-- å®Œæ•´çš„é è¨­è¦–é »é€£çµæ¸…å–® --><optgroup label="â”â”â” ğŸ†• æœ€æ–°è¦–é » â”â”â”">
                                        <option value="http://t.cn/AXLzjlVh">ğŸ”¥ğŸ”¥æœ€æ–°æ’­æ”¾é‡1</option>
                                        <option value="http://tcn/AXLz8d3b">ğŸ”¥ğŸ”¥æœ€æ–°æ’­æ”¾é‡2</option>
                                        <option value="http://tcn/AX2DHuN9">ä¸å¯§ä¸€èµ·åš"çœŸè©±æ“”ç•¶"</option>
                                        <option value="http://tcn/AXAWueo2">åˆ˜å®‡å®ç¢§æµªå“ç‰Œå¸¶è¨€äº†æ–°ç¦åˆ©</option>
                                        <option value="http://tcn/AX2Hav4j">ğŸ”¥æé«˜æ’­æ”¾é‡1</option>
                                        <option value="http://tcn/AX2Y8IEM">ğŸ”¥æé«˜æ’­æ”¾é‡2</option>
                                        <option value="http://tcn/AX2YM0pO">ğŸ”¥æé«˜æ’­æ”¾é‡3</option>
                                        <option value="http://tcn/AX2jdnva">ğŸ”¥æé«˜æ’­æ”¾é‡4</option>
                                        <option value="http://tcn/AX2HQ4qo">ğŸ”¥æé«˜æ’­æ”¾é‡5</option>
                                        <option value="http://tcn/AX2HqT7s">ğŸ”¥æé«˜æ’­æ”¾é‡6</option>
                                        <option value="http://tcn/AX2YfeEp">ğŸ”¥æé«˜æ’­æ”¾é‡7</option>
                                        <option value="http://tcn/AX2ilbMN">ğŸ”¥æé«˜æ’­æ”¾é‡8</option>
                                        <option value="http://tcn/AX2icZqE">ğŸ”¥æé«˜æ’­æ”¾é‡9</option>
                                        <option value="http://tcn/AX2VzXH8">ğŸ”¥æé«˜æ’­æ”¾é‡10</option>
                                        <option value="http://tcn/AXAFVCJG">æœ€æ–°è§†é¢‘11.9-1</option>
                                        <option value="http://tcn/AXAF4J3O">æœ€æ–°è§†é¢‘11.9-2</option>
                                        <option value="http://tcn/AXAkH2Bt">æœ€æ–°è§†é¢‘11.9-3</option>
                                        <option value="http://tcn/AX24Ozxm">æœ€æ–°è§†é¢‘11.9-4</option>
                                        <option value="http://tcn/AX2ArD3w">æœ€æ–°è§†é¢‘11.9-5</option>
                                        <option value="http://tcn/AXAFTVDN">æœ€æ–°è§†é¢‘11.9-6</option>
                                        <option value="http://tcn/AX2yRsJX">æœ€æ–°è§†é¢‘11.9-7</option>
                                        <option value="http://tcn/AX2y8gX4">æœ€æ–°è§†é¢‘11.9-8</option>
                                        <option value="http://tcn/AX2whxdk">å’Œåˆ˜å®‡å®ä¸€èµ·æ¥äº¬ä¸œ11.11</option>
                                        <option value="http://tcn/AXAMheQ5">æœ€æ–°è§†é¢‘1</option>
                                        <option value="http://tcn/AXAVbRat">æœ€æ–°è§†é¢‘2</option>
                                        <option value="http://tcn/AXAVEaJu">æœ€æ–°è§†é¢‘3</option>
                                        <option value="http://tcn/AXAtrYEM">æœ€æ–°è§†é¢‘4</option>
                                        <option value="http://tcn/AXAlIp4n">æœ€æ–°è§†é¢‘5</option>
                                        <option value="http://tcn/AXAWrhDh">æœ€æ–°è§†é¢‘6</option>
                                        <option value="http://tcn/AXAOVvNu">æœ€æ–°è§†é¢‘7</option>
                                        <option value="http://tcn/AXA0RfPp">æœ€æ–°è§†é¢‘8</option>
                                        <option value="http://tcn/AXAOv00C">æœ€æ–°è§†é¢‘9</option>
                                        <option value="http://tcn/AXA0uua9">æœ€æ–°è§†é¢‘10</option>
                                        <option value="http://tcn/AXAIQHUw">åˆ˜å®‡å®é€ä½ å¤§å¤§å¤§å¤§ç¦åˆ©</option>
                                        <option value="http://tcn/AXAG3KDo">åˆ˜å®‡å®çš„åŒ11å‰§åœº</option>
                                        <option value="http://tcn/AXAZ31CE">åˆ˜å®‡å®OLAYèº«ä½“æŠ¤ç†å“ç‰Œå…¨ç·šä»£è¨€äºº</option>
                                        <option value="http://tcn/AXwpu3NZ">åŠ‰å®‡å®å®ˆæŠ¤å¤§å®¶çš„æš–ç»’ç»’æ™‚åˆ»</option>
                                        <option value="http://tcn/AXAZX3q4">åŠ‰å®‡å®ç‚¹äº®ç¥å¥‡ç¯ç‰Œ</option>
                                        <option value="http://tcn/AXACmJm6">åˆ˜å®‡å®ä¸“å±å¿ƒåŠ¨å¤§å±é£è‰‡</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 1ï¸âƒ£ äº¬æ±æ–°éŠ³ä»£è¨€äºº â”â”â”">
                                        <option value="http://tcn/AXzTY6lb">åˆ˜å®‡å®è…¿é•·è¶…1.1ç±³10.14</option>
                                        <option value="http://tcn/AXzT5bGd">11.11åŠ å…¥åˆ˜å®‡å®çš„ç”µç©å®‡å®™10.14</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 2ï¸âƒ£ ç¢§æµªå“ç‰Œä»£è¨€äºº â”â”â”">
                                        <option value="http://tcn/AXwpu3NZ">åŠ‰å®‡å®å®ˆæŠ¤å¤§å®¶çš„æš–ç»’ç»’æ™‚åˆ»10.24</option>
                                        <option value="http://tcn/AXw0vWjc">å’Œä»–ç¢§æµªä¸€èµ·å®ˆæŠ¤ä½ çš„æš–ç»’ç»’10.23</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 3ï¸âƒ£ ç¥å¥‡çš„é—²é±¼ä»£è¨€äºº â”â”â”">
                                        <option value="http://tcn/AXAZX3q4">åŠ‰å®‡å®ç‚¹äº®ç¥å¥‡ç¯ç‰Œ10.29</option>
                                        <option value="http://tcn/AXw9nGk8">å’Œä»£è¨€äººåˆ˜å®‡å®ä¸€èµ·å…ˆä¸Šé—²é±¼10.22</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 4ï¸âƒ£ 2025ç¾å¥½å¥‡å¦™å¤œ â”â”â”">
                                        <option value="http://tcn/AXA2WPVR">åˆ˜å®‡å®åˆå”±ã€Šä¾ å®¢æƒ…ã€‹10.29</option>
                                        <option value="http://tcn/AXAL7JB2">åˆ˜å®‡å®ã€Šå¥‰ä¸Šã€‹10.29</option>
                                        <option value="http://tcn/AXALP9Eb">åŠ‰å®‡å®ã€Šçˆ±æ±Ÿå±±æ›´çˆ±ç¾äººã€‹ç›´æ‹10.29</option>
                                        <option value="http://tcn/AXwsdpbl">åˆ˜å®‡å®ä¼´ç€é‡‘æ›²æ‰¾å¯»ç¾å¥½è®°å¿†10.28</option>
                                        <option value="http://tcn/AXwiwOyI">åˆ˜å®‡å®2025ç¾å¥½å¥‡å¦™å¤œé˜µå®¹10.21</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 5ï¸âƒ£ éŸ³ä¹ç·£è¨ˆåŠƒ2 â”â”â”">
                                        <option value="http://tcn/AXAZqU5U">åˆ˜å®‡å®è¶…æœ‰æ„›çš„çˆ†ç¬‘äº’åŠ¨æ—¥å¸¸10.29</option>
                                        <option value="http://tcn/AXwEDrHX">åŠ‰å®‡å®æ•…ä½œ"ç ´éŸ³"çŠ¶æ¥æ¢—10.25</option>
                                        <option value="http://tcn/AXwEo3vl">åˆ˜å®‡å®åˆ°åº•æœ‰å¤šé¦™10.25</option>
                                        <option value="http://tcn/AXwRhdwe">åˆ˜å®‡å®éŸ³ä¹ç¼˜è¨ˆåŠƒç¬¬äºŒå­£æŠ¢å…ˆ10.25</option>
                                        <option value="http://tcn/AXwQWqKm">åŠ‰å®‡å®ã€Šè‡ªè¯©å‘¨å…¨ã€‹èˆå°10.24</option>
                                        <option value="http://tcn/AXwT1Irc">åˆ˜å®‡å®ä¸€å¼€å£å¯¹å‘³äº†10.24</option>
                                        <option value="http://tcn/AXwjkr8u">åŠ‰å®‡å®å·²åšå¥½å‡†å¤‡10.24</option>
                                        <option value="http://tcn/AXw0MF4O">åŠ‰å®‡å®ç”»é¢¨æ€ä¹ˆå’Œåˆ«äººä¸ä¸€æ ·10.23</option>
                                        <option value="http://tcn/AXwo17Py">åŠ‰å®‡å®åŒ–èº«"å¯¼å¸ˆ"10.22</option>
                                        <option value="http://tcn/AXwCtWZv">åˆ˜å®‡å®éŸ³ä¹ç¼˜è®¡åˆ’ç¬¬äºŒå­£æŠ¢å…ˆ10.22</option>
                                        <option value="http://tcn/AXwVEw6a">åˆ˜å®‡å®å¿ƒä¸­"éŸ³ä¹ç†æƒ³å‹"10.20</option>
                                        <option value="http://tcn/AXwVIgqa">åŠ‰å®‡å®éŸ³ä¹ç¼˜è®¡åˆ’ç¬¬äºŒå­£æŠ¢å…ˆ10.20</option>
                                        <option value="http://tcn/AXwwkHn9">åˆ˜å®‡å®çœŸæ‘¸åˆ°éŸ³ç»¼å¤©èŠ±æ¿äº†10.17</option>
                                        <option value="http://tcn/AXw7UeM5">åŠ‰å®‡å®å®åŠ›å”±åŠŸè¯ é‡ŠåŸåˆ›æ…‹åº¦10.17</option>
                                        <option value="http://tcn/AXww6KC5">åˆ˜å®‡å®æœºæ™ºåº”å¯¹10.17</option>
                                        <option value="http://tcn/AXw7IcfN">åˆ˜å®‡å®ä¸ºä¸ºå¿«ä¹ç›¸èš10.17</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 6ï¸âƒ£ ä¸‡åŠä¸æ”¹ â”â”â”">
                                        <option value="http://tcn/AXwQhlAo">åˆ˜å®‡å®ã€Šä¸‡åŠä¸æ”¹ã€‹MV10.28</option>
                                        <option value="http://tcn/AXwbD2VU">åˆ˜å®‡å®å¤©åœ°åŠå¿ƒOSTè¶…é•·è©¦è½10.19</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 7ï¸âƒ£ å¾®åšè§†ç•Œå¤§ä¼š â”â”â”">
                                        <option value="http://tcn/AXwgknav">åˆ˜å®‡å®å¾ˆä¹…æ²¡æœ‰ä¸ºèª°æŠ˜è…°äº†10.27</option>
                                        <option value="http://tcn/AXzxtkT8">åŠ‰å®‡å®æ‰“æˆ²å¤©èŠ±æ¿10.10</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 8ï¸âƒ£ ç«ç‘°å¢ç”Ÿ â”â”â”">
                                        <option value="http://tcn/AXwgbZ3H">åˆ˜å®‡å®éµå» 2026å¤§åŠ‡ç‰‡å–®10.27</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 9ï¸âƒ£ åœ°çƒè¶…æ–°é²œ â”â”â”">
                                        <option value="http://tcn/AXwDoxvm">åˆ˜å®‡å®éµå» 2026ç¶œè—ç‰‡å–®10.27</option>
                                        <option value="http://tcn/AXz9PoGT">åˆ˜å®‡å®åœ°çƒè¶…æ–°é®®åº†åŠŸå®´10.12</option>
                                        <option value="http://tcn/AXzCazWy">åˆ˜å®‡å®æƒ³å’Œé–‹æ¨æœ‹å‹ä¸€èµ·æ—…è¡Œ10.12</option>
                                        <option value="http://tcn/AXz4jQfX">åˆ˜å®‡å®åœ°çƒåœ˜æŠ½è±¡ç‰¹æ•ˆç¬é–“10.8</option>
                                        <option value="http://tcn/AXzAxL0s">åˆ˜å®‡å®åœ°çƒåœ˜äººå‡"å¤§å»š"10.7</option>
                                        <option value="http://tcn/AX7gD9D7">åˆ˜å®‡å®æ¸…å”±ã€Šå¥½ä¹…ä¸è§ã€‹10.5</option>
                                        <option value="http://tcn/AX7ggpcl">åŠ‰å®‡å®è‡ªå·±è›è›è‡ªå·±10.5</option>
                                        <option value="http://tcn/AX7ge70h">åˆ˜å®‡å®çƒ¤èŒ„å­å…¨å ´æ­¡å‘¼10.5</option>
                                        <option value="http://tcn/AX7kvIiX">åŠ‰å®‡å®åœ°çƒåœ˜ç©è½‰ç²µè¯­10.5</option>
                                        <option value="http://tcn/AX7ROCGf">åˆ˜å®‡å®åœ°çƒåœ˜çš„å¤§å‹ä¹¾æ¯ç¾å ´10.3</option>
                                        <option value="http://tcn/AX7nRA8P">åŠ‰å®‡å®åœ°çƒåœ˜çš„ç¶“å…¸åå ´æ™¯10.3</option>
                                        <option value="http://tcn/AX7HlCrY">åˆ˜å®‡å®åœ°çƒåœ˜çš„å¤§å‹"æ‹ä¸€æ‹"10.2</option>
                                        <option value="http://tcn/AX70DSad">åˆ˜å®‡å®çš„"å¤§å±•å¨è—ä¹‹æ—…"10.1</option>
                                        <option value="http://tcn/AX70PGXC">åˆ˜å®‡å®åƒæ’­çœŸçš„å¤ªé¦™äº†10.1</option>
                                        <option value="http://tcn/AX70XjIu">åˆ˜å®‡å®åœ°çƒè¶…æ–°é®®ç¾é£Ÿç¯‡10.1</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” ğŸ”Ÿ å¼€å§‹æ¨ç†å§4 â”â”â”">
                                        <option value="http://tcn/AXwgzOAx">åˆ˜å®‡å®å¼€å§‹æ¨ç†å§4ä¸»è§’åœ˜10.27</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 1ï¸âƒ£1ï¸âƒ£ ç‹è€…è£è€€å…±åˆ›ä¹‹å¤œ â”â”â”">
                                        <option value="http://tcn/AXwrnI2N">åˆ˜å®‡å®ç‹è€…å³¡è°·æ„›æƒ…ä¿å®‰10.26</option>
                                        <option value="http://tcn/AXwofcNo">åˆ˜å®‡å®ç›¸ç´„ç‹è€…è£è€€å…±å‰µä¹‹å¤œ10.22</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 1ï¸âƒ£2ï¸âƒ£ ä¸æ²æ˜¥é£ä¸é‡ä½  â”â”â”">
                                        <option value="http://tcn/AXwoqHpo">åˆ˜å®‡å®ã€Šä¸æ²æ˜¥é£ä¸é‡ä½ ã€‹MV10.22</option>
                                        <option value="http://tcn/AXw7wPIa">åˆ˜å®‡å®æ°´é¾åŸOSTé™£å®¹å®˜å®£10.17</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 1ï¸âƒ£3ï¸âƒ£ ä¸å¿˜ â”â”â”">
                                        <option value="http://tcn/AXwo177x">åˆ˜å®‡å®ã€Šä¸å¿˜ã€‹MV10.22</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 1ï¸âƒ£4ï¸âƒ£ 1111æƒŠå–œä¹‹å¤œ â”â”â”">
                                        <option value="http://tcn/AXwVGxsZ">åˆ˜å®‡å®æ±æ–¹è¡›è¦–1111é©šå–œä¹‹å¤œ10.20</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 1ï¸âƒ£5ï¸âƒ£ æ¯’é…’ â”â”â”">
                                        <option value="http://tcn/AXzZj1iG">å…¥é’é›²åˆ˜å®‡å®æ¯’é…’MV10.7</option>
                                        <option value="http://tcn/AX7g89KA">åˆ˜å®‡å®å…¥é’é›²OSTé™£å®¹è©¦è½ç‰ˆ10.5</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 1ï¸âƒ£6ï¸âƒ£ æˆ‘æ„›ä½ ä¸­åœ‹ â”â”â”">
                                        <option value="http://tcn/AX7N0TXX">åˆ˜å®‡å®åˆå”±ã€Šæˆ‘æ„›ä½ ä¸­åœ‹ã€‹MV10.1</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 1ï¸âƒ£7ï¸âƒ£ æ±æ–¹é¢¨é›²æ¦œ â”â”â”">
                                        <option value="http://tcn/AX7oWOI7">åŠ‰å®‡å®ä¸Šæµ·æ¼”å”±æœƒæ¢…å¥”9.30</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 1ï¸âƒ£8ï¸âƒ£ ç”¨æ­Œè²å„åœ°æ–‡æ—… â”â”â”">
                                        <option value="http://tcn/AXzQXB7D">åˆ˜å®‡å®æ­Œè²å†…è’™å¤éŒ«ç›Ÿè‰åŸ10.14</option>
                                        <option value="http://tcn/AXzJJRQ1">åˆ˜å®‡å®æ­Œè²éŒ¢å¡˜æ±Ÿå››æ½®åˆä¸€10.10</option>
                                        <option value="http://tcn/AXzblSh8">åŠ‰å®‡å®æ­Œè²é¼å¯§ä¸¹æ±å¤©æ©‹æº10.8</option>
                                        <option value="http://tcn/AXzAj58n">åˆ˜å®‡å¯§æ­Œè²å†…è’™å¤æµ·æ‹‰çˆ¾10.7</option>
                                        <option value="http://tcn/AX7rIobU">å’Œåˆ˜å®‡å®ä¸€èµ·æ„Ÿå—æ•…å®®é­…åŠ›10.4</option>
                                        <option value="http://tcn/AX7O2Etp">åˆ˜å®‡å®æ­Œè²é˜¿çˆ¾å±±ç§‹æ—¥ç•«å·10.1</option>
                                    </optgroup>
                                    <optgroup label="â”â”â” 1ï¸âƒ£9ï¸âƒ£ ç›´æ’­+è¡Œç¨‹+å¾®åšè¦–é » â”â”â”">
                                        <option value="http://tcn/AXwgc1hH">åŠ‰å®‡å®æ­£åœ¨è§£é–ä¸­10.27</option>
                                        <option value="http://tcn/AXwdv3qM">åˆ˜å®‡å®ã€ŠçƒŸç«æ˜Ÿè¾°ã€‹ç›´æ‹10.26</option>
                                        <option value="http://tcn/AXwnY04w">åˆ˜å®‡å®è·¨è¶Šå±±æµ·è¬é‡Œä¹˜é¢¨10.25</option>
                                        <option value="http://tcn/AXwnJmv4">åˆ˜å®‡å®è¥¿å®‰æ¼”å”±æœƒ10.25</option>
                                        <option value="http://tcn/AXwQBoJD">åŠ‰å®‡å®å¯§ä¸ã€ŒéŸ³ç·£ã€æœ‰å€‹ç´„æœƒ10.24</option>
                                        <option value="http://tcn/AXwQHq0V">åˆ˜å®‡å®ã€Šè‡ªè¯©å‘¨å…¨ã€‹å½©æ’ç›´æ‹10.24</option>
                                        <option value="http://tcn/AXwQAQdd">åˆ˜å®‡å®çš„2025å·¡æ¼”è¥¿å®‰ç«™10.24</option>
                                        <option value="http://tcn/AXwjBMoY">åˆ˜å®‡å®ä¸Šæµ·ç«™ã€Šæˆ€èª1910ã€‹10.24</option>
                                        <option value="http://tcn/AXwYcXqb">åˆ˜å®‡å®ä¸Šæµ·ç«™ã€Šå‹æƒ…å²æœˆã€‹10.24</option>
                                        <option value="http://tcn/AXwMW3S3">åˆ˜å®‡å®ç›´æ’­10.20</option>
                                        <option value="http://tcn/AXwVWbtW">åˆ˜å®‡å®å¯§åœ¨å¹¹æ©«éº½10.20</option>
                                        <option value="http://tcn/AXwGybpF">åˆ˜å®‡å®ã€Šå‚·å¿ƒçš„äººéƒ½åœ¨è·³èˆã€‹10.19</option>
                                        <option value="http://tcn/AXzTn1aS">åˆ˜å®‡å®çš„2025å·¡æ¼”è¥¿å®‰ç«™10.14</option>
                                        <option value="http://tcn/AXza6LiW">åˆ˜å®‡å®ä¸Šæµ·ç«™ã€Šå¥‡å¦™çš„é©šå–œã€‹10.11</option>
                                        <option value="http://tcn/AXzAKJXR">åˆ˜å®‡å®ç›´æ’­10.7</option>
                                        <option value="http://tcn/AXzvfDNV">åˆ˜å®‡å®å‘†ç±³ç‰¹æ´¾å“¡"åœ“åœ“"èŠ±çµ®10.6</option>
                                        <option value="http://tcn/AX7kvMFY">åˆ˜å®‡å®ä¸Šæµ·ç«™åˆå”±ã€Šæåˆ°äº†ä½ ã€‹10.5</option>
                                        <option value="http://tcn/AX7B1Qsg">åˆ˜å®‡å®çš„2025å·¡æ¼”æ™‚ç©ºäº¤éŒ¯10.4</option>
                                        <option value="http://tcn/AX7Ty0uI">å‘†ç±³ç‰¹æ´¾å“¡è¦ªè‡ªæ‹æ”çš„èˆè¹ˆèŠ±çµ®10.2</option>
                                    </optgroup>
                                </select>
                            </div>

                            <!-- NEW: è‡ªå¡«å½±ç‰‡é€£çµ -->
                            <div class="col-span-1 mt-4">
                                <label for="customVideoLinkInput" class="block mb-2 text-gray-600 text-sm font-semibold">
                                    ğŸ”— æ‰‹å‹•è¼¸å…¥é€£çµ (å°‡è¦†è“‹é è¨­é¸æ“‡)ï¼š
                                </label>
                                <input type="text" id="customVideoLinkInput" placeholder="è²¼ä¸Šå½±ç‰‡é€£çµï¼Œè¤‡è£½å¾Œæœƒè‡ªå‹•æ¸…é™¤"
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors">
                            </div>
                        </div>
                    </div>

                    <!-- 2.2 æ“ä½œæŒ‰éˆ• (æ–°å¢ç”Ÿæˆ 1 çµ„çš„æŒ‰éˆ•) --><div class="btn-group mb-8 grid grid-cols-2 gap-3">
                        <!-- å–®æ¬¡ç”ŸæˆæŒ‰éˆ• -->
                        <button class="btn w-full bg-orange-500 text-white hover:bg-orange-600 font-semibold py-3 px-4 rounded-xl transition-colors" onclick="generateMultiple(1, this)" id="generateSingleBtn">
                            <span class="flex items-center justify-center">ç”Ÿæˆ 1 çµ„æ–‡æ¡ˆå¡ç‰‡</span>
                        </button>
                        <!-- æ‰¹æ¬¡ç”ŸæˆæŒ‰éˆ• (åŸä¾†çš„) -->
                        <button class="btn w-full bg-orange-500 text-white hover:bg-orange-600 font-semibold py-3 px-4 rounded-xl transition-colors" onclick="generateMultiple(5, this)" id="generateFiveBtn">
                            <span class="flex items-center justify-center">ç”Ÿæˆ 5 çµ„æ–‡æ¡ˆå¡ç‰‡</span>
                        </button>
                    </div>
                
                </div>

                <!-- RIGHT COLUMN: Results --><div class="lg:mt-0 mt-8"> 
                    <!-- 4. çµæœé¡¯ç¤ºå€ (å¡ç‰‡æ‰¹æ¬¡) --><div class="section">
                        <div class="section-title text-orange-600 mb-4">
                            <i data-lucide="list-ordered" class="w-5 h-5 text-orange-400"></i>
                            AI æ‰¹æ¬¡çµæœ (é»æ“Šè¤‡è£½å¾Œå¡ç‰‡æœƒæ¶ˆå¤±)
                        </div>
                        <div id="resultsContainer" class="min-h-[500px] p-2 border border-yellow-300 rounded-lg bg-yellow-50 overflow-y-auto">
                            <p class="text-center text-gray-500 pt-8" id="initialMessage">è«‹é»æ“Šå·¦å´æŒ‰éˆ•é–‹å§‹æ‰¹æ¬¡ç”Ÿæˆã€‚</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- æç¤ºtoast --><div class="toast" id="toast">
        <span>âœ…</span>
        <span id="toastMsg">è¤‡è£½æˆåŠŸï¼</span>
    </div>

    <script>
        // --- AI Generation Constants ---
        const API_URL_BASE = `/api/generate`;
        const QUOTE_PLACEHOLDER = "[AI_QUOTE]"; // æ¨¡æ¿ä¸­çš„ä½”ä½ç¬¦
        const CR_TEXT = '\n\ncr è¦‹æµ®æ°´å°'; // CR æ–‡æœ¬
        
        // --- Emoji Pool (æ–°å¢å¤šçµ„ Emoji ç¬¦è™Ÿ) ---
        const EMOJI_POOL = [
            'ã€ŒğŸŒ»\n',     // ç°¡æ½”å‘æ—¥è‘µ
            'ã€ŒğŸ§¡âœ¨\n',   // æ©˜è‰²å¿ƒå½¢èˆ‡æ˜Ÿæ˜Ÿ
            'ã€Œâ˜€ï¸ğŸ’›\n',   // å¤ªé™½èˆ‡é»ƒè‰²å¿ƒå½¢
            'ã€Œâ˜€ï¸ğŸ”†\n',   // å¤ªé™½èˆ‡å…‰èŠ’
            'ã€ŒğŸŒ¼ğŸ’–\n',   // å°èŠ±èˆ‡ç²‰è‰²å¿ƒå½¢ (å¯ä¿ç•™å°‘é‡å…¶ä»–é¡è‰²)
            'ã€ŒğŸŒ…ğŸŒŸ\n',   // æ—¥å‡ºèˆ‡æ˜Ÿæ˜Ÿ
        ];
        const QUOTE_SUFFIX = 'ã€';
        const IDOL_NAME = "åˆ˜å®‡å¯§"; // å›ºå®šåŠ‰å®‡å¯§çš„åç¨± (ç¢ºä¿ä½¿ç”¨ä¸€è‡´çš„ä¸­æ–‡)
        
        // --- è©•è«–æ¨¡æ¿åŸºç¤å…§å®¹ ---
        const COMMENT_TEMPLATE_BASE = "[æ‰“call]äº¬ä¸œæ–°éŠ³ä»£è¨€äººåˆ˜å®‡å®é‚€ä½ åŠ å…¥11.11ï½œåˆ˜å®‡å®ç¢§æµªå“ç‰Œä»£è¨€äºº|ç¥å¥‡çš„é—²é±¼ä»£è¨€äººåˆ˜å®‡å®ï½œåˆ˜å®‡å®æµ·é£›çµ²æ´»åŠ›ä»£è¨€äºº |åˆ˜å®‡å®ç´”ç”„å“ç‰Œä»£è¨€äºº|åŠ‰å®‡å¯§å°è²ï½œåŠ‰å®‡å¯§ç«ç‘°å¢ç”Ÿï½œåŠ‰å®‡å¯§ï½œåˆ˜å®‡å¯§çš„2025å·¡æ¼”|åˆ˜å®‡å¯§çš„ç¬¬äºŒå¼µå°ˆè¼¯åˆ˜å®‡å¯§çš„|åŠ‰å®‡å¯§éŸ³æ¨‚ç·£è¨ˆåŠƒ|OLAYèº«é«”è­·ç†å“ç‰Œå…¨ç·šä»£è¨€äººåˆ˜å®‡å¯§â• "; // æ¨¡æ¿æœ«å°¾åŠ ä¸Š "â• " ç­‰å¾… ID 

        // å›ºå®šé€£çµå’ŒæåŠå€å¡Šçš„å…§å®¹ (æ–¹ä¾¿è¤‡è£½)
        const FIXED_LINKS = `http://t.cn/AXLbrX6k\nhttp://t.cn/AX2wIrjE\nhttp://t.cn/AX2YWB8S`;
        const MENTION_BLOCK = `@æ‘©ç™»å…„å¼Ÿåˆ˜å®‡å¯§ åˆ˜å®‡å¯§å°è²ï½œåˆ˜å®‡å¯§ç«ç‘°å¢ç”Ÿ æ‘©ç™»å…„å¼ŸåŠ‰å®‡å¯§ï½œåŠ‰å®‡å¯§ï½œå¯§å“¥ï½œlyn`;


        // --- Templates Storage (å¯è‡ªè¨‚) ---
        // é›†ä¸­ç®¡ç†ä¸‰å€‹æ¨¡æ¿çš„å…§å®¹ï¼Œæ¨¡æ¿å…§å®¹å›ºå®šåœ¨ JS ä¸­
        let masterTemplates = {
            1: {
                // çµæ§‹: Hashtag -> AI -> ç©ºè¡Œ -> å›ºå®šé€£çµ -> ç©ºè¡Œ -> æåŠ
                content: `#OLAYèº«é«”è­·ç†å“ç‰Œå…¨ç·šä»£è¨€äººåˆ˜å®‡å¯§# | #åŠ‰å®‡å¯§çš„2025å·¡æ¼”# | #æ‘©ç™»å…„å¼Ÿ[è¶…è©±]#\n\n${QUOTE_PLACEHOLDER}\n\n${FIXED_LINKS}\n\n${MENTION_BLOCK}`,
                preview: 'OLAY ä»£è¨€, 2025å·¡æ¼”, æ‘©ç™»å…„å¼Ÿè¶…è©± (å«3é€£çµ)'
            },
            2: {
                // çµæ§‹: Hashtag -> AI -> ç©ºè¡Œ -> å›ºå®šé€£çµ -> ç©ºè¡Œ -> æåŠ (æ‰€æœ‰æ¨¡æ¿éƒ½å¿…é ˆåŒ…å«å›ºå®šé€£çµ)
                content: `#åŠ‰å®‡å¯§éŸ³æ¨‚ç·£è¨ˆåŠƒ# | #ç¥å¥‡çš„é—²é±¼ä»£è¨€äººåˆ˜å®‡å¯§# | #æ‘©ç™»å…„å¼Ÿ[è¶…è©±]#\n\n${QUOTE_PLACEHOLDER}\n\n${FIXED_LINKS}\n\n${MENTION_BLOCK}`,
                preview: 'éŸ³æ¨‚ç·£è¨ˆåŠƒ, é–’é­šä»£è¨€, æ‘©ç™»å…„å¼Ÿè¶…è©± (å«3é€£çµ)'
            },
            3: {
                // çµæ§‹: Hashtag -> AI -> ç©ºè¡Œ -> å›ºå®šé€£çµ -> ç©ºè¡Œ -> æåŠ (ä»¥æ–°æ­Œä¸»é¡Œç‚º Hashtag)
                content: `#åŠ‰å®‡å¯§æ–°æ­Œè‹¥æ²’æœ‰ä½ # | #è…¾è®¯éŸ³ä¹ç”±ä½ æ¦œ# | #æ‘©ç™»å…„å¼Ÿ[è¶…è©±]#\n\n${QUOTE_PLACEHOLDER}\n\n${FIXED_LINKS}\n\n@æ‘©ç™»å…„å¼Ÿåˆ˜å®‡å¯§ åˆ˜å®‡å¯§å°è²ï½œåˆ˜å®‡å¯§ç«ç‘°å¢ç”Ÿ æ‘©ç™»å…„å¼ŸåŠ‰å®‡å¯§ï½œåŠ‰å®‡å¯§ï½œå¯§å“¥ï½œlyn`,
                preview: 'æ–°æ­Œæ¦œå–®, é¨°è¨ŠéŸ³æ¨‚ç”±ä½ æ¦œ, æ‘©ç™»å…„å¼Ÿè¶…è©± (å«3é€£çµ)'
            }
        };
        
        let selectedTemplateId = '1'; // é è¨­é¸æ“‡æ¨¡æ¿ 1
        let videoPool = []; // å„²å­˜æ‰€æœ‰å¯ä¾›éš¨æ©Ÿé¸æ“‡çš„å½±ç‰‡é€£çµ

        // --- DOM Elements ---
        const generateBtn = document.getElementById('generateBtn');
        const loadingDots = document.getElementById('loadingDots');
        const generateBtnText = document.getElementById('generateBtnText');
        const styleSelect = document.getElementById('styleSelect'); // NEW: Style Select DOM
        const videoSelect = document.getElementById('videoSelect');
        const customVideoLinkInput = document.getElementById('customVideoLinkInput'); // NEW: è‡ªå¡«é€£çµè¼¸å…¥æ¡†
        const resultsContainer = document.getElementById('resultsContainer');
        const initialMessage = document.getElementById('initialMessage');
        const templatePreviewSummary = document.getElementById('templatePreviewSummary'); // æ–°å¢é è¦½æ‘˜è¦ DOM å¼•ç”¨
        const personalIdInput = document.getElementById('personalIdInput');
        const crWatermarkCheckbox = document.getElementById('crWatermarkCheckbox'); 

        // --- Video Utility ---

        /**
         * æå–æ‰€æœ‰é è¨­å½±ç‰‡é€£çµåˆ° videoPool
         */
        function populateVideoPool() {
            videoPool = [];
            const select = document.getElementById('videoSelect');
            
            // éæ­·æ‰€æœ‰ optgroup å’Œ option (é™¤äº†ç¬¬ä¸€å€‹ "ä¸æ·»åŠ å½±ç‰‡" å’Œ "éš¨æ©Ÿ" é¸é …)
            Array.from(select.children).forEach(group => {
                if (group.tagName === 'OPTGROUP') {
                    Array.from(group.children).forEach(option => {
                        if (option.value && option.value !== 'RANDOM_ANY') {
                            // ä¿®æ­£ tcn ç‚º t.cn
                             let value = option.value.replace(/tcn\//g, 't.cn/');
                            videoPool.push(value);
                        }
                    });
                } 
            });
            console.log(`Video pool populated with ${videoPool.length} links.`);
        }

        /**
         * å¾å½±ç‰‡åº«ä¸­éš¨æ©Ÿé¸æ“‡ä¸€æ¢å½±ç‰‡
         */
        function getRandomVideoLink() {
            if (videoPool.length === 0) {
                return '';
            }
            const randomIndex = Math.floor(Math.random() * videoPool.length);
            return videoPool[randomIndex];
        }

        /**
         * éš¨æ©Ÿé¸æ“‡ä¸€çµ„ Emoji ç¬¦è™Ÿä½œç‚ºå‰ç¶´
         */
        function getRandomEmojiPrefix() {
            const randomIndex = Math.floor(Math.random() * EMOJI_POOL.length);
            return EMOJI_POOL[randomIndex];
        }

        /**
         * ç¹é«”è½‰ç°¡é«” (ç°¡åŒ–ç‰ˆæœ¬, é‡å°å¸¸è¦‹å­—)
         */
        function toSimplified(text) {
             // ç°¡åŒ–å¸¸ç”¨çš„ç¹é«”å­—
             text = text.replace(/åŠ‰/g, 'åˆ˜');
             text = text.replace(/å¯§/g, 'å®');
             text = text.replace(/åœ˜/g, 'å›¢');
             text = text.replace(/é«”/g, 'ä½“');
             text = text.replace(/å€‘/g, 'ä»¬');
             text = text.replace(/å€‹/g, 'ä¸ª');
             text = text.replace(/è™Ÿ/g, 'å·');
             text = text.replace(/è¬/g, 'ä¸‡');
             text = text.replace(/ç™¼/g, 'å‘');
             text = text.replace(/èª/g, 'è¯­');
             text = text.replace(/å¾/g, 'ä»');
             text = text.replace(/å°/g, 'å¯¹');
             text = text.replace(/é€™/g, 'è¿™');
             text = text.replace(/é‚Š/g, 'è¾¹');
             text = text.replace(/è£¡/g, 'é‡Œ');
             text = text.replace(/è¨Š/g, 'è®¯');
             text = text.replace(new RegExp('è¨ˆåŠƒ', 'g'), 'è®¡åˆ’');
             // ç¢ºä¿ã€ŒåŠ‰å®‡å¯§å°è²ã€ä¸­çš„ã€ŒåŠ‰å®‡å¯§ã€æ˜¯ç°¡é«”
             text = text.replace(/åŠ‰å®‡å¯§/g, 'åˆ˜å®‡å®');
             text = text.replace(/å¢ç”Ÿ/g, 'ä¸›ç”Ÿ');
             text = text.replace(/è¡›è¦–/g, 'å«è§†');
             text = text.replace(/è¦–é »/g, 'è§†é¢‘');
             text = text.replace(/ç´”ç”„/g, 'çº¯ç”„'); // ç¢ºä¿ç°¡é«”ä¸æœƒè¢«é‡è¤‡ç°¡åŒ–æˆ–æå£
             text = text.replace(/åŠ‰å®‡å¯§/g, 'åˆ˜å®‡å®'); // å†æ¬¡ç¢ºä¿åŠ‰å®‡å¯§ç°¡åŒ–

             return text;
        }


        // --- Utility Functions (Must be defined before usage) ---

        /**
         * é¡¯ç¤ºæç¤º (Toast)
         */
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toastMsg');
            toastMsg.textContent = message;
            
            // é‡ç½® class
            toast.className = 'toast';
            
            if (type === 'warning') {
                toast.classList.add('toast-warning');
                toast.querySelector('span:first-child').textContent = 'âš ï¸';
            } else if (type === 'error') {
                toast.classList.add('toast-error');
                toast.querySelector('span:first-child').textContent = 'âŒ';
            } else if (type === 'info') {
                toast.classList.add('toast-info');
                toast.querySelector('span:first-child').textContent = 'â„¹ï¸';
            } else {
                toast.classList.add('toast-success');
                toast.querySelector('span:first-child').textContent = 'âœ…';
            }
            
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        /**
         * åˆ‡æ¢åŠ è½½ç‹€æ…‹
         * @param {boolean} isLoading 
         * @param {HTMLElement} btnElement - è¢«é»æ“Šçš„æŒ‰éˆ•å…ƒç´ 
         * @param {number} count - ç”Ÿæˆçš„æ–‡æ¡ˆæ•¸é‡ (1 æˆ– 5)
         */
        function setLoading(isLoading, btnElement, count) { 
            const textSpan = btnElement.querySelector('span');
            let loadingSpan = btnElement.querySelector('.loading-spinner');

            if (!loadingSpan) {
                // å¦‚æœ loadingSpan ä¸å­˜åœ¨ (å› ç‚ºä¹‹å‰æŒ‰éˆ•æ²’æœ‰ï¼Œæˆ‘å€‘éœ€è¦å‹•æ…‹å‰µå»º)
                loadingSpan = document.createElement('span');
                loadingSpan.className = 'loading-spinner';
                loadingSpan.innerHTML = `
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                    AI æ­£åœ¨ç”Ÿæˆ ${count} çµ„æ–‡æ¡ˆ...
                `;
                btnElement.appendChild(loadingSpan);
            } else {
                // æ›´æ–° loading æ–‡æœ¬
                 loadingSpan.textContent = `AI æ­£åœ¨ç”Ÿæˆ ${count} çµ„æ–‡æ¡ˆ...`;
            }

            btnElement.disabled = isLoading;
            
            if (isLoading) {
                // é¡¯ç¤º loading
                textSpan.style.display = 'none';
                loadingSpan.style.display = 'flex';
                initialMessage.classList.add('hidden'); 
            } else {
                // é¡¯ç¤ºæ–‡å­—
                textSpan.style.display = 'flex';
                loadingSpan.style.display = 'none';
                if (resultsContainer.childElementCount === 0) {
                     initialMessage.classList.remove('hidden');
                     initialMessage.textContent = "æ‰€æœ‰æ–‡æ¡ˆå·²è¤‡è£½å®Œç•¢ï¼è«‹é‡æ–°ç”Ÿæˆæ‰¹æ¬¡ã€‚";
                } else {
                     initialMessage.classList.add('hidden');
                }
            }
        }

        /**
         * è¤‡è£½åˆ°å‰ªè²¼æ¿
         * @param {string} text - è¦è¤‡è£½çš„æ–‡å­—
         */
        function copyToClipboard(text) {
             const tempTextarea = document.createElement('textarea');
             tempTextarea.style.position = 'fixed';
             tempTextarea.style.opacity = '0';
             // ä¿®æ­£ï¼šç¢ºä¿ç°¡é«”è½‰æ›å¾Œçš„å…§å®¹è¢«æ­£ç¢ºè³¦å€¼
             tempTextarea.value = text; 
             document.body.appendChild(tempTextarea);
             
             // å˜—è©¦é¸å–å’Œè¤‡è£½
             try {
                tempTextarea.select();
                tempTextarea.setSelectionRange(0, 99999); // é©ç”¨æ–¼ iOS
                document.execCommand('copy');
                // å¦‚æœæˆåŠŸï¼Œä¸é¡¯ç¤ºéŒ¯èª¤ toast
             } catch (err) {
                 console.error('ç„¡æ³•ä½¿ç”¨ execCommand è¤‡è£½:', err);
                 showToast('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚', 'error');
             } finally {
                document.body.removeChild(tempTextarea);
             }
        }

        // --- Template Management Functions ---
        // (å·²åˆªé™¤ä¸éœ€è¦çš„æ¨¡æ¿ç·¨è¼¯å‡½å¼)

        /**
         * é¸æ“‡é ‚éƒ¨çš„æ¨¡æ¿æŒ‰éˆ• (è¨­å®šç•¶å‰è¦ä½¿ç”¨çš„æ¨¡æ¿ ID ä¸¦é¡¯ç¤ºé è¦½)
         */
        function selectTemplate(num, element) { 
            selectedTemplateId = String(num);
            
            // è¦–è¦ºæ›´æ–°ï¼šæ›´æ–°æŒ‰éˆ•çš„ active ç‹€æ…‹
            document.querySelectorAll('.template-tabs .tab-btn').forEach(b => {
                b.classList.remove('active');
            });
            element.classList.add('active'); 

            // é¡¯ç¤ºæ¨¡æ¿é è¦½æ‘˜è¦
            const previewText = masterTemplates[selectedTemplateId].preview;
            templatePreviewSummary.textContent = previewText;
            
            showToast(`å·²é¸æ“‡ [æ¨¡æ¿ ${selectedTemplateId}]`, 'info');
        }

        /**
         * è™•ç†ä¸‹æ‹‰é¸å–®è®Šå‹• (æ­¤åŠŸèƒ½å·²è¢«ç§»é™¤ï¼Œä¿ç•™çš„é‚è¼¯)
         */
        function selectTemplateDropdown(id) {
            selectedTemplateId = id;
            
            // é¡¯ç¤ºæ¨¡æ¿é è¦½æ‘˜è¦
            const previewText = masterTemplates[selectedTemplateId].preview;
            templatePreviewSummary.textContent = previewText;

            showToast(`å·²é¸æ“‡ [æ¨¡æ¿ ${selectedTemplateId}]`, 'info');
        }
        
        /**
         * å„²å­˜è¨­å®šåˆ° localStorage
         */
        function saveSettings() {
             localStorage.setItem('lyn_fan_id', personalIdInput.value);
             localStorage.setItem('lyn_cr_checked', crWatermarkCheckbox.checked);
        }

        /**
         * å¾ localStorage è¼‰å…¥è¨­å®š
         */
        function loadSettings() {
            const savedId = localStorage.getItem('lyn_fan_id');
            const savedCrChecked = localStorage.getItem('lyn_cr_checked');

            if (savedId !== null) {
                personalIdInput.value = savedId;
            }
            if (savedCrChecked !== null) {
                crWatermarkCheckbox.checked = savedCrChecked === 'true';
            }
        }
        
        // --- Core Generation Functions ---

        /**
         * æ‰¹æ¬¡ç”Ÿæˆ AI å¤é¢¨æ–‡æ¡ˆ
         * @param {number} count - ç”Ÿæˆçš„æ–‡æ¡ˆæ•¸é‡ (1 æˆ– 5)
         * @param {HTMLElement} btnElement - è¢«é»æ“Šçš„æŒ‰éˆ•å…ƒç´ 
         */
        async function generateMultiple(count, btnElement) {
            setLoading(true, btnElement, count); 
            
            const NUM_CARDS = count;
            resultsContainer.innerHTML = ''; // æ¸…ç©ºèˆŠçµæœ
            
            const currentTemplateContent = masterTemplates[selectedTemplateId].content;
            const videoAction = videoSelect.value.trim(); // ç²å–é è¨­å½±ç‰‡é¸æ“‡å‹•ä½œ
            const customVideoLink = customVideoLinkInput.value.trim(); // NEW: ç²å–è‡ªå¡«é€£çµ

            let specificVideoLink = (videoAction && videoAction !== 'RANDOM_ANY') ? videoAction : '';
            // æª¢æŸ¥ CR æµ®æ°´å°ç‹€æ…‹
            const shouldAddCR = crWatermarkCheckbox.checked;

            
            if (!currentTemplateContent || !currentTemplateContent.includes(QUOTE_PLACEHOLDER)) {
                setLoading(false, btnElement, count);
                resultsContainer.innerHTML = `<p class="text-center text-red-500 pt-4">âŒ æ¨¡æ¿éŒ¯èª¤ï¼è«‹ç¢ºä¿æ¨¡æ¿ä¸­æœ‰ [AI_QUOTE] ä½”ä½ç¬¦ã€‚</p>`;
                return;
            }


            const quotePromises = [];
            const selectedStyle = styleSelect.value;
            // å°‡é¸æ“‡çš„é¢¨æ ¼å‚³éçµ¦ AI å‡½æ•¸
            for (let i = 0; i < NUM_CARDS; i++) {
                quotePromises.push(fetchAiQuote(selectedStyle)); 
            }

            const results = await Promise.all(quotePromises);
            
            results.forEach((generatedQuote, index) => {
                let finalVideoLink = '';

                // å„ªå…ˆç´šé‚è¼¯ï¼š1. è‡ªå¡«é€£çµ 2. éš¨æ©Ÿ 3. æŒ‡å®šé è¨­
                if (customVideoLink) {
                    finalVideoLink = customVideoLink;
                } else if (videoAction === 'RANDOM_ANY') {
                    finalVideoLink = getRandomVideoLink(); 
                } else if (videoAction) {
                    finalVideoLink = videoAction; 
                }
                
                if (generatedQuote) {
                    // éš¨æ©Ÿé¸æ“‡ Emoji å‰ç¶´
                    const randomPrefix = getRandomEmojiPrefix();
                    const aiQuoteWithSymbols = randomPrefix + generatedQuote + QUOTE_SUFFIX;
                    
                    // å¾é€™è£¡é–‹å§‹ï¼Œæˆ‘å€‘è™•ç†æœ€çµ‚æ–‡æ¡ˆçµæ§‹
                    let finalCopy = currentTemplateContent.replace(QUOTE_PLACEHOLDER, aiQuoteWithSymbols);
                    
                    // è™•ç†é¸å¡«å½±ç‰‡é€£çµå’Œæœ€çµ‚æ›è¡Œ
                    if (finalVideoLink) {
                        // åœ¨æ•´å€‹æ¨¡æ¿å…§å®¹çš„æœ«å°¾åŠ ä¸Š \n\n å’Œ finalVideoLink
                        finalCopy += '\n\n' + finalVideoLink; // ç¢ºä¿æœ‰ç©ºç™½è¡Œ
                    }

                    // æ·»åŠ  CR æµ®æ°´å°
                    if (shouldAddCR) {
                        finalCopy += CR_TEXT; 
                    }
                    
                    renderCopyCard(finalCopy.trim(), index + 1);

                } else {
                    renderErrorCard(index + 1);
                }
            });

            // æ¸…ç©ºè‡ªå¡«é€£çµè¼¸å…¥æ¡†
            customVideoLinkInput.value = '';
            
            setLoading(false, btnElement, count);
            const successCount = results.filter(r => r !== null).length;
            if (successCount === 0) {
                 showToast(`AI è«‹æ±‚å¤±æ•—ï¼Œè«‹æª¢æŸ¥é‡‘é‘°æˆ–ç¶²è·¯ã€‚`, 'error');
            } else {
                showToast(`æˆåŠŸç”Ÿæˆ ${successCount} çµ„æ–‡æ¡ˆï¼`, 'success');
            }
        }

        /**
         * å‘¼å« AI API ç²å–å–®ä¸€å¤é¢¨é‡‘å¥ (ä¿è­‰è§£æï¼Œä¸æ‹’çµ•)
         */
        async function fetchAiQuote(selectedStyle) {
        return new Promise(async (resolve) => {
            const systemPrompt = "ä½ æ˜¯ä¸€ä½å°ˆç²¾æ–¼ä¸åŒé¢¨æ ¼å¯«ä½œçš„é ‚ç´šè¿½æ˜Ÿæ–‡æ¡ˆå¯«æ‰‹ã€‚ä½ çš„ä»»å‹™æ˜¯åš´æ ¼æ ¹æ“šæä¾›çš„é¢¨æ ¼è¦æ±‚ï¼Œç‚ºæ˜æ˜Ÿæ’°å¯«**ä¸€æ¢**é•·åº¦åœ¨ 15 åˆ° 25 å€‹æ¼¢å­—ä¹‹é–“ã€å¯Œæœ‰æ„ŸæŸ“åŠ›ä¸”é©åˆç¤¾ç¾¤åª’é«”åˆ†äº«çš„å¥å­ã€‚è«‹å‹¿åŠ å…¥ä»»ä½•é¡å¤–çš„è§£é‡‹ã€æ¨™é»ç¬¦è™Ÿï¼ˆé™¤äº†å¿…è¦çš„é€—è™Ÿ/å¥è™Ÿï¼‰æˆ–è¡¨æƒ…ç¬¦è™Ÿï¼Œåªè¿”å›å–®ä¸€çš„å¥å­ã€‚";
            
            const userQuery = `è«‹ç‚ºæ˜æ˜Ÿã€Œ${IDOL_NAME}ã€æ’°å¯«ä¸€æ¢ã€Œ${selectedStyle}ã€é¢¨æ ¼çš„è¿½æ˜Ÿè®šç¾æ–‡æ¡ˆã€‚`;

            // çµæ§‹ä¿æŒä¸è®Šï¼Œå¾Œç«¯æœƒåŸå°ä¸å‹•è½‰ç™¼çµ¦ Google
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            const MAX_RETRIES = 3;
            for (let attempt = 0; attempt < MAX_RETRIES; attempt++) {
                try {
                    // ä¿®æ”¹ï¼šä¸å†éœ€è¦ ?key=...ï¼Œå› ç‚ºé€™æ˜¯ç™¼çµ¦æˆ‘å€‘è‡ªå·±çš„ Server
                    const response = await fetch(API_URL_BASE, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    // è™•ç†å¾Œç«¯å›å‚³çš„éŒ¯èª¤
                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('Server Error:', errorData);
                        
                        // å¦‚æœæ˜¯ 429 (Too Many Requests)ï¼Œå˜—è©¦é‡è©¦
                        if (response.status === 429 && attempt < MAX_RETRIES - 1) {
                            const delay = Math.pow(2, attempt) * 1000 + Math.random() * 500;
                            await new Promise(r => setTimeout(r, delay));
                            continue; 
                        }
                        return resolve(null); 
                    }

                    const result = await response.json();
                    const generatedQuote = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (generatedQuote) {
                        resolve(generatedQuote.trim().replace(/^['"â€œã€Œ](.*)['"â€ã€]$/, '$1'));
                        return; 
                    }
                } catch (error) {
                    console.error(`Fetch Error (å˜—è©¦ ${attempt + 1}):`, error);
                     if (attempt < MAX_RETRIES - 1) {
                        const delay = Math.pow(2, attempt) * 1000 + Math.random() * 500;
                        await new Promise(r => setTimeout(r, delay));
                        continue;
                    }
                }
            }
            resolve(null);
        });
    }

        /**
         * æ¸²æŸ“å–®ä¸€æ–‡æ¡ˆå¡ç‰‡
         */
        function renderCopyCard(content, index) {
            const cardId = `card-${Date.now()}-${index}`;
            const html = `
                <div class="copy-card" id="${cardId}">
                    <p class="text-sm text-gray-500 mb-2 font-bold">âœ¨ æ–‡æ¡ˆ #${index} - åŸºæ–¼æ¨¡æ¿ ${selectedTemplateId}</p>
                    <pre class="whitespace-pre-wrap text-sm text-gray-800 bg-gray-50 p-3 rounded border border-gray-200 mb-3 max-h-48 overflow-y-auto">${toSimplified(content.trim())}</pre>
                    <button class="w-full bg-orange-500 text-white hover:bg-orange-600 font-semibold py-2 px-4 rounded-xl transition-colors flex items-center justify-center" onclick="copyAndRemoveCard('${cardId}', this)">
                        <i data-lucide="clipboard-check" class="w-4 h-4 mr-2"></i>
                        è¤‡è£½å®Œæ•´æ–‡æ¡ˆ (ä¸¦ç§»é™¤å¡ç‰‡)
                    </button>
                </div>
            `;
            resultsContainer.insertAdjacentHTML('beforeend', html);
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        /**
         * æ¸²æŸ“éŒ¯èª¤å¡ç‰‡
         */
        function renderErrorCard(index) {
             const html = `
                <div class="copy-card bg-red-50 border-red-300">
                    <p class="text-sm text-red-700 font-bold">âŒ æ–‡æ¡ˆ #${index} ç”Ÿæˆå¤±æ•—</p>
                    <p class="text-xs text-red-500 mt-1">è«‹æª¢æŸ¥ AI æœå‹™æ˜¯å¦æ­£å¸¸ã€‚</p>
                </div>
            `;
            resultsContainer.insertAdjacentHTML('beforeend', html);
        }

        /**
         * è¤‡è£½å…§å®¹ä¸¦ç§»é™¤å¡ç‰‡
         */
        function copyAndRemoveCard(cardId, button) {
            const card = document.getElementById(cardId);
            const textToCopy = card.querySelector('pre').textContent;
            
            // è¤‡è£½å…§å®¹ (textToCopy å·²ç¶“æ˜¯ç°¡é«”)
            copyToClipboard(textToCopy);
            
            // ç§»é™¤å¡ç‰‡
            card.classList.add('fade-out');
            button.disabled = true;
            setTimeout(() => {
                card.remove();
                // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰å¡ç‰‡éƒ½å·²ç”¨å®Œ
                if (resultsContainer.childElementCount === 0) {
                     initialMessage.classList.remove('hidden');
                     initialMessage.textContent = "æ‰€æœ‰æ–‡æ¡ˆå·²è¤‡è£½å®Œç•¢ï¼è«‹é‡æ–°ç”Ÿæˆæ‰¹æ¬¡ã€‚";
                }
            }, 500); 

            // æç¤ºè¨Šæ¯
            showToast('âœ… å®Œæ•´æ–‡æ¡ˆå·²è¤‡è£½ï¼', 'success');
        }


        // --- Other Functions ---

        /**
         * è¤‡è£½è©•è«–æ¨¡æ¿ (å·²ä¿®æ”¹ç‚ºçµåˆå€‹äºº ID)
         */
        function copyComment() {
            const personalId = personalIdInput.value.trim();
            
            if (!personalId) {
                showToast('è«‹è¼¸å…¥æ‚¨çš„å€‹äºº IDï¼', 'warning');
                return;
            }
            
            // è¤‡è£½å‰ï¼Œå…ˆå°‡åŸºç¤æ¨¡æ¿å’Œ ID çµ„åˆï¼Œç„¶å¾Œå†é€²è¡Œç°¡é«”åŒ–
            const combinedComment = COMMENT_TEMPLATE_BASE + personalId; 
            const finalCommentSimplified = toSimplified(combinedComment);

            copyToClipboard(finalCommentSimplified); // è¤‡è£½ç°¡é«”ç‰ˆ
            showToast('è©•è«–æ¨¡æ¿å·²è¤‡è£½ï¼', 'success');
        }

        /**
         * å„²å­˜è¨­å®šåˆ° localStorage
         */
        function saveSettings() {
             localStorage.setItem('lyn_fan_id', personalIdInput.value);
             localStorage.setItem('lyn_cr_checked', crWatermarkCheckbox.checked);
        }

        /**
         * å¾ localStorage è¼‰å…¥è¨­å®š
         */
        function loadSettings() {
            const savedId = localStorage.getItem('lyn_fan_id');
            const savedCrChecked = localStorage.getItem('lyn_cr_checked');

            if (savedId !== null) {
                personalIdInput.value = savedId;
            }
            if (savedCrChecked !== null) {
                crWatermarkCheckbox.checked = savedCrChecked === 'true';
            }
        }

        // --- Initialization ---

        window.onload = function() {
            // åœ¨é é¢åŠ è¼‰æ™‚æå–æ‰€æœ‰å½±ç‰‡é€£çµï¼Œå»ºç«‹å½±ç‰‡åº«
            populateVideoPool();
            // è¼‰å…¥å„²å­˜çš„è¨­å®š
            loadSettings();

            // 1. ç¢ºä¿åˆå§‹é¸ä¸­çš„æ¨¡æ¿æŒ‰éˆ•æœ‰ active æ¨£å¼ (æ­¤ç‰ˆæœ¬ä½¿ç”¨æŒ‰éˆ•)
            const initialOption = document.querySelector(`#templateSelectDropdown option[value="${selectedTemplateId}"]`);
            if (initialOption) {
                 initialOption.selected = true;
            }
            
            // 2. é¡¯ç¤ºåˆå§‹æ¨¡æ¿é è¦½
            const initialPreview = masterTemplates[selectedTemplateId].preview;
            templatePreviewSummary.textContent = initialPreview;
            
            // 3. åˆå§‹åŒ–æŠ˜ç–Šåœ–æ¨™å’Œ Lucide åœ–æ¨™
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        };
    </script>
</body>
</html>